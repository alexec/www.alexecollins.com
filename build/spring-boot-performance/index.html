<!doctype html> <html> <head> <meta charset=utf-8 /> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <meta name=viewport content="width=device-width, initial-scale=1.0"> <meta name=google-site-verification content=459WLyNfyiKwT7T3IzdCjzIpNP-IVQSOb4tR8b2vQhI /> <title>Alex Collins - Spring Boot Performance</title> <link href="/css/bootstrap.min.css" media=screen rel=stylesheet /> <style type="text/css">
.highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight {
  color: #faf6e4;
  background-color: #122b3b;
}
.highlight .gl {
  color: #dee5e7;
  background-color: #4e5d62;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #6c8b9f;
  font-style: italic;
}
.highlight .cp {
  color: #b2fd6d;
  font-weight: bold;
  font-style: italic;
}
.highlight .err {
  color: #fefeec;
  background-color: #cc0000;
}
.highlight .gr {
  color: #fefeec;
  background-color: #cc0000;
}
.highlight .k, .highlight .kd, .highlight .kv {
  color: #f6dd62;
  font-weight: bold;
}
.highlight .o, .highlight .ow {
  color: #4df4ff;
}
.highlight .p, .highlight .pi {
  color: #4df4ff;
}
.highlight .gd {
  color: #cc0000;
}
.highlight .gi {
  color: #b2fd6d;
}
.highlight .ge {
  font-style: italic;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gt {
  color: #dee5e7;
  background-color: #4e5d62;
}
.highlight .kc {
  color: #f696db;
  font-weight: bold;
}
.highlight .kn {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kp {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kr {
  color: #ffb000;
  font-weight: bold;
}
.highlight .gh {
  color: #ffb000;
  font-weight: bold;
}
.highlight .gu {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kt {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .no {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nc {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nd {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nn {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .bp {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .ne {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nl {
  color: #ffb000;
  font-weight: bold;
}
.highlight .nt {
  color: #ffb000;
  font-weight: bold;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #f696db;
  font-weight: bold;
}
.highlight .ld {
  color: #f696db;
  font-weight: bold;
}
.highlight .ss {
  color: #f696db;
  font-weight: bold;
}
.highlight .s, .highlight .sb, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .sr, .highlight .s1 {
  color: #fff0a6;
  font-weight: bold;
}
.highlight .se {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .sc {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .si {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .nb {
  font-weight: bold;
}
.highlight .ni {
  color: #999999;
  font-weight: bold;
}
.highlight .w {
  color: #BBBBBB;
}
.highlight .nf {
  color: #a8e1fe;
}
.highlight .py {
  color: #a8e1fe;
}
.highlight .na {
  color: #a8e1fe;
}
.highlight .nv, .highlight .vc, .highlight .vg, .highlight .vi {
  color: #a8e1fe;
  font-weight: bold;
}	.article img {
		border: 1px solid #bbb;
		display: block;
		margin-left: auto;
		margin-right: auto;
		padding: 10px;
	}
	@media print {
		#disqus_thread, #sidebar {
    			display:none;
  		}
	}
</style> <link href="https://plus.google.com/101694420547181110548" rel=publisher /> </head> <body class="spring-boot-performance spring-boot-performance_index"> <div class=container> <div class=row> <div class="col-md-9 article"> <h1>Spring Boot Performance</h1> <table class=table> <tr> <td> <center> <a href="//selenium-webdriver-in-practice.github.io"><img src="/images/liang_cover100.jpg" class=thumbnail /></a> </center> </td> <td> <p class=well><b>Big news!</b> I've been working hard getting <b>Selenium WebDriver in Practice</b> ready and it is now available to buy on the <a href="//selenium-webdriver-in-practice.github.io">Manning Early Access Program</a>. It provides practical and useful techniques you can use with WebDriver, to get the very best out of it in your projects.</p> </td> </tr> </table> <p>This is an article on how to improve the performance of Spring Boot applications. I've recently been working on a new project. As we primarily use Java and Spring, we've been looking at <strong>Spring Boot</strong>. It's allowed us to get up and running quickly. </p> <p>Early on, I came across a problem with a prototype for one of our new applications. It was loading the Velocity web page template engine. I could not understand why – it was just some REST services, no web pages. I spent a bit of time looking into this issue, and how to improve the performance of Spring Boot applications, and this is what I found.</p> <h2 id=component-scanning-slows-start-up>Component Scanning Slows Start-up</h2> <p>By default, you may find yourself using the <a href="//docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/autoconfigure/SpringBootApplication.html"><code>@SpringBootApplication</code></a> annotation to get your application configured automatically. This has a couple of side-effects. One is to enable <strong>component scanning</strong>. This looks through the classes to find ones annotated with Spring "stereotypes", such as <code>@Component</code>. This is convenient, especially when you start out, but it has two side-effects:</p> <ol> <li>It slows application start-up time. This will have a greater impact if you have a large application, or a large number of integration tests that need to start up the application to run.</li> <li>It may load beans you don't want or need. </li> </ol> <p>You can disable component scanning by removing the <code>@SpringBootApplication</code> and <code>@ComponentScan</code> annotations. You'll then need to make each bean explicit in your configuration.</p> <pre class="highlight java"><span class="c1">// remove @SpringBootApplication and @ComponentScan, replace with @EnableAutoConfiguration</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableAutoConfiguration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleWebUiApplication</span> <span class="o">{</span>

	<span class="c1">// ...</span>

	<span class="c1">// you must explicitly list all beans that were being component scanned	@Bean</span>
	<span class="kd">public</span> <span class="n">MessageController</span> <span class="n">messageController</span><span class="o">(</span><span class="n">MessageRepository</span> <span class="n">messageRepository</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="n">MessageController</span><span class="o">(</span><span class="n">messageRepository</span><span class="o">);</span>
	<span class="o">}</span>
</pre> <h2 id=auto-configuration-can-load-more-than-you-need>Auto-Configuration Can Load More Than You Need</h2> <p>The <code>@SpringBootApplication</code> annotation implies the <code>@EnableAutoConfiguration</code> annotation. This enables auto-configuration. This can load components you don't need, slowing application start-up and increasing memory and CPU usage. Lets look at how to use this in a more controlled fashion.</p> <p>If you start your application using <code>-Ddebug</code> it'll print a report of the components it auto-configures:</p> <pre class="highlight shell">mvn spring-boot:run -Ddebug
…
<span class="o">=========================</span>
AUTO-CONFIGURATION REPORT
<span class="o">=========================</span>


Positive matches:
-----------------

   DispatcherServletAutoConfiguration
      - @ConditionalOnClass classes found: org.springframework.web.servlet.DispatcherServlet <span class="o">(</span>OnClassCondition<span class="o">)</span>
      - found web application StandardServletEnvironment <span class="o">(</span>OnWebApplicationCondition<span class="o">)</span>

...
</pre> <p>Copy the classes mentioned in the ""positive matches" section of the report:</p> <pre class="highlight plaintext">DispatcherServletAutoConfiguration
EmbeddedServletContainerAutoConfiguration
ErrorMvcAutoConfiguration
HttpEncodingAutoConfiguration
HttpMessageConvertersAutoConfiguration
JacksonAutoConfiguration
JmxAutoConfiguration
MultipartAutoConfiguration
ServerPropertiesAutoConfiguration
PropertyPlaceholderAutoConfiguration
ThymeleafAutoConfiguration
WebMvcAutoConfiguration
WebSocketAutoConfiguration
</pre> <p>Update your configuration to explicitly import them, and run your tests to make sure everything is OK.</p> <pre class="highlight java"><span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">({</span>
        <span class="n">DispatcherServletAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">EmbeddedServletContainerAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">ErrorMvcAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">HttpEncodingAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">HttpMessageConvertersAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">JacksonAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">JmxAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">MultipartAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">ServerPropertiesAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">PropertyPlaceholderAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">ThymeleafAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">WebMvcAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">WebSocketAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleWebUiApplication</span> <span class="o">{</span>
</pre> <p>I can see that both JMX and web sockets are listed, but I know I'm not using them. I can delete them, and any other dependencies I don't need, to get a performance improvement. Run your tests again to make sure everything is OK.</p> <h2 id=change-servlet-container-to-undertow>Change Servlet Container To Undertow</h2> <p>By default, Spring Boot uses Tomcat. Tomcat uses around 110mb of heap, and has ~16 threads: </p> <p><img alt=tomcat src="/images/tomcat-spring-boot-jvisualvm.png"/></p> <p>Undertow is a lightweight servlet container from JBoss. You can <a href="//docs.spring.io/spring-boot/docs/current/reference/html/howto-embedded-servlet-containers.html#howto-use-undertow-instead-of-tomcat">switch to Undertow</a> to get a performance improvement. Firstly, exclude Tomcat from your dependencies:</p> <pre class="highlight xml"><span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
<span class="nt">&lt;/exclusions&gt;</span>
</pre> <p>Add Undertow: </p> <pre class="highlight xml"><span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-undertow<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre> <p>Undertow uses around 90MB and has ~13 threads: </p> <p><img alt=undertow src="/images/undertow-spring-boot-jvisualvm.png"/></p> <h2 id=conclusion>Conclusion</h2> <p>These are a few small tips on improving the performance of your Spring Boot applications. The benefits are smaller for smaller applications, but for larger applications can quickly become pronounced. Try it out and tell me what you think.</p> <p>As usual, <a href="https://github.com/alexec/spring-boot-performance">the code is on Github</a>.</p> <h2 id=references>References</h2> <ul> <li><a href="https://www.techempower.com/benchmarks/">https://www.techempower.com/benchmarks/</a></li> <li><a href="https://cloud.google.com/appengine/articles/spring_optimization">https://cloud.google.com/appengine/articles/spring_optimization</a></li> </ul> <div id=disqus_thread></div> <script>
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'alexecollins'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> <div class=col-md-3 id=sidebar> <center> <h2>Alex Collins</h2> <p> <a href="/"><img src="/images/alex-collins-circle.png"/></a> </p> </center> <p> Java technical lead and solutions architect in London for the UK IT industry for over ten years. <a href="/about-me">more...</a> </p> <h4>Docker Maven Plugin</h4> <p>Version 2.11.4 released, <a href="https://github.com/alexec/docker-maven-plugin/blob/master/CHANGELOG.md">more...</a></p> <pre style="font-size:50%">&lt;dependency&gt;
  &lt;groupId&gt;com.alexecollins.docker&lt;/groupId&gt;
  &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.11.4&lt;/version&gt;
&lt;/dependency&gt;</pre> <h4>Related</h4> <ol> <li><a href="/tutorial-hibernate-jpa-spring-mvc-part-2/">Tutorial: Hibernate, JPA & Spring MVC - Part 2</a></li> <li><a href="/tutorial-integration-testing-selenium-part-2/">Tutorial: Integration Testing with Selenium - Part 2</a></li> <li><a href="/tutorial-integration-testing-selenium-part-1/">Tutorial: Integration Testing with Selenium - Part 1</a></li> <li><a href="/jmeter-custom-sampler-template/">JMeter Custom Sampler Template</a></li> <li><a href="/spring-mvc-and-mongodb-auditing-actions/">Spring MVC and MongoDB - Auditing Actions</a></li> </ol> <h4>Recent</h4> <ul> <li><a href="/developing-with-docker-proxy-container-pattern/">Developing With Docker - Using The Proxy Container Pattern To Make Development Easier</a> <span>Nov 28</span></li> <li><a href="/practical-domain-specific-language-tutorial/">Practical Java Domain Specific Language Tutorial</a> <span>Sep 19</span></li> <li><a href="/sonarqube-and-java-8/">Sonarqube And Java 8</a> <span>Sep 17</span></li> <li><a href="/spring-boot-performance/">Spring Boot Performance</a> <span>Sep 5</span></li> <li><a href="/testing-anti-patterns/">Testing Anti-Patterns</a> <span>Jun 23</span></li> </ul> <h4>Tags</h4> <a href="/tags/ci/">ci</a> (3)</a>&nbsp;&nbsp; <a href="/tags/concurrency/">concurrency</a> (4)</a>&nbsp;&nbsp; <a href="/tags/docker/">docker</a> (11)</a>&nbsp;&nbsp; <a href="/tags/gist/">gist</a> (13)</a>&nbsp;&nbsp; <a href="/tags/groovy/">groovy</a> (4)</a>&nbsp;&nbsp; <a href="/tags/java/">java</a> (48)</a>&nbsp;&nbsp; <a href="/tags/jmeter/">jmeter</a> (3)</a>&nbsp;&nbsp; <a href="/tags/junit/">junit</a> (7)</a>&nbsp;&nbsp; <a href="/tags/links/">links</a> (14)</a>&nbsp;&nbsp; <a href="/tags/maven/">maven</a> (18)</a>&nbsp;&nbsp; <a href="/tags/oped/">oped</a> (8)</a>&nbsp;&nbsp; <a href="/tags/performance/">performance</a> (6)</a>&nbsp;&nbsp; <a href="/tags/plaf/">plaf</a> (14)</a>&nbsp;&nbsp; <a href="/tags/ruby/">ruby</a> (3)</a>&nbsp;&nbsp; <a href="/tags/selenium/">selenium</a> (9)</a>&nbsp;&nbsp; <a href="/tags/software/">software</a> (10)</a>&nbsp;&nbsp; <a href="/tags/spring/">spring</a> (7)</a>&nbsp;&nbsp; <a href="/tags/swing/">swing</a> (15)</a>&nbsp;&nbsp; <a href="/tags/testing/">testing</a> (23)</a>&nbsp;&nbsp; <a href="/tags/tips/">tips</a> (4)</a>&nbsp;&nbsp; <a href="/tags/tomcat/">tomcat</a> (3)</a>&nbsp;&nbsp; <a href="/tags/unix/">unix</a> (6)</a>&nbsp;&nbsp; <a href="/tags/web/">web</a> (4)</a>&nbsp;&nbsp; </hr/> <p> <a class="btn btn-primary btn-xs" href="/sitemap">Sitemap</a> <a class="btn btn-primary btn-xs" href="/feed.xml">RSS</a> <a class="btn btn-primary btn-xs" href="//uk.linkedin.com/in/alexecollins">LinkedIn</a> </p> </div> </div> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-25388993-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script> </body> </html>