<!doctype html> <html> <head> <meta charset=utf-8 /> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <meta name=viewport content="width=device-width, initial-scale=1.0"> <meta name=google-site-verification content=459WLyNfyiKwT7T3IzdCjzIpNP-IVQSOb4tR8b2vQhI /> <title>Alex Collins - Tutorial: Integration Testing with Selenium - Part 1</title> <link href="/css/bootstrap.min.css" media=screen rel=stylesheet /> <style type="text/css">
.highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight {
  color: #faf6e4;
  background-color: #122b3b;
}
.highlight .gl {
  color: #dee5e7;
  background-color: #4e5d62;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #6c8b9f;
  font-style: italic;
}
.highlight .cp {
  color: #b2fd6d;
  font-weight: bold;
  font-style: italic;
}
.highlight .err {
  color: #fefeec;
  background-color: #cc0000;
}
.highlight .gr {
  color: #fefeec;
  background-color: #cc0000;
}
.highlight .k, .highlight .kd, .highlight .kv {
  color: #f6dd62;
  font-weight: bold;
}
.highlight .o, .highlight .ow {
  color: #4df4ff;
}
.highlight .p, .highlight .pi {
  color: #4df4ff;
}
.highlight .gd {
  color: #cc0000;
}
.highlight .gi {
  color: #b2fd6d;
}
.highlight .ge {
  font-style: italic;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gt {
  color: #dee5e7;
  background-color: #4e5d62;
}
.highlight .kc {
  color: #f696db;
  font-weight: bold;
}
.highlight .kn {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kp {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kr {
  color: #ffb000;
  font-weight: bold;
}
.highlight .gh {
  color: #ffb000;
  font-weight: bold;
}
.highlight .gu {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kt {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .no {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nc {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nd {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nn {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .bp {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .ne {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nl {
  color: #ffb000;
  font-weight: bold;
}
.highlight .nt {
  color: #ffb000;
  font-weight: bold;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #f696db;
  font-weight: bold;
}
.highlight .ld {
  color: #f696db;
  font-weight: bold;
}
.highlight .ss {
  color: #f696db;
  font-weight: bold;
}
.highlight .s, .highlight .sb, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .sr, .highlight .s1 {
  color: #fff0a6;
  font-weight: bold;
}
.highlight .se {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .sc {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .si {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .nb {
  font-weight: bold;
}
.highlight .ni {
  color: #999999;
  font-weight: bold;
}
.highlight .w {
  color: #BBBBBB;
}
.highlight .nf {
  color: #a8e1fe;
}
.highlight .py {
  color: #a8e1fe;
}
.highlight .na {
  color: #a8e1fe;
}
.highlight .nv, .highlight .vc, .highlight .vg, .highlight .vi {
  color: #a8e1fe;
  font-weight: bold;
}	.article img {
		border: 1px solid #bbb;
		display: block;
		margin-left: auto;
		margin-right: auto;
		padding: 10px;
	}
	@media print {
		#disqus_thread, #sidebar {
    			display:none;
  		}
	}
</style> <link href="https://plus.google.com/101694420547181110548" rel=publisher /> </head> <body class="tutorial-integration-testing-selenium-part-1 tutorial-integration-testing-selenium-part-1_index"> <div class=container> <div class=row> <div class="col-md-9 article"> <h1>Tutorial: Integration Testing with Selenium - Part 1</h1> <table class=table> <tr> <td> <center> <a href="//selenium-webdriver-in-practice.github.io"><img src="/images/liang_cover100.jpg" class=thumbnail /></a> </center> </td> <td> <p class=well><b>Big news!</b> I've been working hard getting <b>Selenium WebDriver in Practice</b> ready and it is now available to buy on the <a href="//selenium-webdriver-in-practice.github.io">Manning Early Access Program</a>. It provides practical and useful techniques you can use with WebDriver, to get the very best out of it in your projects.</p> </td> </tr> </table> <h2>Overview</h2> <p>I've been using this for sometime and I've come across a few things that appear to make life easier. I thought I'd share this as a tutorial, so I'll walk you through these parts:</p> <ol> <li>Setting up a web project using Maven, configuring Selenium to run as an integration test on a C.I.</li> <li>Look into good ways to model the pages in your site using "page objects" and other ways to create points of protected-variation.</li> <li>Use JPA and Hibernate to perform CRUD operations on a database, and have Maven perform integration tests on them, without any of the costly and often undocumented set-up that this sometimes entails.</li> </ol> <p>This post assumes you're comfortable with Java, Spring, Maven 2 and, of course, HTML. You'll also want Firefox installed on you computer. This tutorial is intended to be otherwise technology agnostic.</p> <h2>Creating a Webapp</h2> <p>Firstly we'll need a webapp to test. Create an project using the maven-webapp-archetype and call it "selenuim-tutorial".</p> <p>To run integration tests (ITs) we're going to use the Cargo plugin. This starts and stops containers such as Jetty and Tomcat. You can use Cargo to start your site using Jetty (its default) in one command without any changes:</p> <pre class="highlight plaintext">mvn cargo:run
</pre> <p>And check it in you browser at:</p> <p><a href="//localhost:8080/selenuim-tutorial">http://localhost:8080/selenuim-tutorial</a></p> <p>You'll get a 404 without welcome file set-up, so add that to the web.xml file:</p> <pre class="highlight plaintext">&lt;welcome-file-list&gt;
	&lt;welcome-file&gt;/index.jsp&lt;/welcome-file&gt;
&lt;/welcome-file-list&gt;
</pre> <p>If you run cargo:run again you'll now see the "Hello World!" page that was created by Maven.</p> <h2>Configuring Cargo</h2> <p>We can set-up Cargo to start a Jetty container prior to running the tests, and then stop it afterwards. This will allow us to start our site, run the integration tests, and then stop it afterwards.</p> <pre class="highlight plaintext">&lt;plugin&gt;
	&lt;groupId&gt;org.codehaus.cargo&lt;/groupId&gt;
	&lt;artifactId&gt;cargo-maven2-plugin&lt;/artifactId&gt;
	&lt;version&gt;1.2.0&lt;/version&gt;
	&lt;executions&gt;
		&lt;execution&gt;
			&lt;id&gt;start&lt;/id&gt;
			&lt;phase&gt;pre-integration-test&lt;/phase&gt;
			&lt;goals&gt;
				&lt;goal&gt;start&lt;/goal&gt;
			&lt;/goals&gt;
		&lt;/execution&gt;
		&lt;execution&gt;
			&lt;id&gt;stop&lt;/id&gt;
			&lt;phase&gt;post-integration-test&lt;/phase&gt;
			&lt;goals&gt;
				&lt;goal&gt;stop&lt;/goal&gt;
			&lt;/goals&gt;
		&lt;/execution&gt;
	&lt;/executions&gt;
&lt;/plugin&gt;
</pre> <p>You can test this work with:</p> <pre class="highlight plaintext">mvn verify
</pre> <p>One thing to note at this point is that Cargo runs on port 8080. If you've already got a process listening on that port you might see an error similar to this:</p> <pre class="highlight plaintext">java.net.BindException: Address already in use
</pre> <p>This might be because you're already running another container on this port. If you want to run this on a C.I. (which may itself run on port 8080), this is likely to be something you'll want to change. Add these lines to the plugin set-up:</p> <pre class="highlight plaintext">&lt;configuration&gt;
	&lt;type&gt;standalone&lt;/type&gt;
	&lt;configuration&gt;
		&lt;properties&gt;
			&lt;cargo.servlet.port&gt;10001&lt;/cargo.servlet.port&gt;
		&lt;/properties&gt;
	&lt;/configuration&gt;
&lt;/configuration&gt;
</pre> <p>Now the app will be here:</p> <p><a href="//localhost:10001/selenuim-tutorial/">http://localhost:10001/selenuim-tutorial/</a></p> <h2>Setting-up Integration Test Phase</h2> <p>Next, we need to be able to run the integration tests. This requires the Maven failsafe plugin with appropriate goals added to your pom:</p> <pre class="highlight plaintext">&lt;plugin&gt;
	&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
	&lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
	&lt;version&gt;2.12&lt;/version&gt;
	&lt;executions&gt;
		&lt;execution&gt;
			&lt;id&gt;default&lt;/id&gt;
			&lt;goals&gt;
				&lt;goal&gt;integration-test&lt;/goal&gt;
				&lt;goal&gt;verify&lt;/goal&gt;
			&lt;/goals&gt;
		&lt;/execution&gt;
	&lt;/executions&gt;
&lt;/plugin&gt;
</pre> <p>By default Failsafe expects tests to match the pattern "src/test/java/<em>/</em>IT.java". Let's create a test to demonstrate this. Note that I haven't changed from Junit 3.8.1 yet. I'll explain to why later on.</p> <p>Here's a basic, incomplete test:</p> <pre class="highlight plaintext">package tutorial;

import junit.framework.TestCase;

public class IndexPageIT extends TestCase {

	@Override
	protected void setUp() throws Exception {
		super.setUp();
	}

	@Override
	protected void tearDown() throws Exception {
		super.tearDown();
	}
	
	public void testWeSeeHelloWorld() {
		fail();
	}
}
</pre> <p>Test that works:</p> <pre class="highlight plaintext">mvn verify
</pre> <p>You should see a single test failure. </p> <p>To test using Selenium you'll need to add a test-scoped dependency to pom.xml:</p> <pre class="highlight plaintext">&lt;dependency&gt;
	&lt;groupId&gt;org.seleniumhq.selenium&lt;/groupId&gt;
	&lt;artifactId&gt;selenium-firefox-driver&lt;/artifactId&gt;
	&lt;version&gt;2.19.0&lt;/version&gt;
	&lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</pre> <p>We can now make a couple of changes to our test:</p> <pre class="highlight plaintext">import org.openqa.selenium.WebDriver;
import org.openqa.selenium.firefox.FirefoxDriver;

â€¦

	private URI siteBase;
	private WebDriver drv;

	@Override
	protected void setUp() throws Exception {
		super.setUp();

		siteBase = new URI("http://localhost:10001/selenuim-tutorial/");
		drv = new FirefoxDriver();
	}

...

	public void testWeSeeHelloWorld() {
		drv.get(siteBase.toString());
		assertTrue(drv.getPageSource().contains("Hello World"));
	}
</pre> <p>We'll remove these hard coded values later on.</p> <p>Run it again:</p> <pre class="highlight plaintext">mvn verify
</pre> <p>You shouldn't see any failures. What you will have is a lingering Firefox. It won't have closed. Run this test 100 times and you'll have 100 Firefoxs running. This will quickly become a problem. We can resolve this by adding this initialisation block to our test:</p> <pre class="highlight json"><span class="w">	</span><span class="p">{</span><span class="w">
		</span><span class="err">Runtime.getRuntime().addShutdownHook(new</span><span class="w"> </span><span class="err">Thread()</span><span class="w"> </span><span class="err">{</span><span class="w">
			</span><span class="err">@Override</span><span class="w">
			</span><span class="err">public</span><span class="w"> </span><span class="err">void</span><span class="w"> </span><span class="err">run()</span><span class="w"> </span><span class="err">{</span><span class="w">
				</span><span class="err">drv.close();</span><span class="w">
			</span><span class="err">}</span><span class="w">
		</span><span class="err">});</span><span class="w">
	</span><span class="err">}</span><span class="w">
</span></pre> <p>Naturally, if we create another test, we'll soon be violating DRY principles. We'll come to that in the next part, as well as looking at what happens when we require a database connection, and some other ways to make sure that your tests are simple to write and easy to maintain.</p> <p><a href="/tutorial-integration-testing-selenium-part-2">Continue to part 2</a></p> <h4>Related</h4> <ol> <li><a href="/tutorial-integration-testing-selenium-part-2/">Tutorial: Integration Testing with Selenium - Part 2</a></li> <li><a href="/mocking-test-dependencies-with-spring/">Mocking Test Dependencies with Spring</a></li> <li><a href="/selenium-and-selenide/">Selenium and Selenide (vs Geb)</a></li> <li><a href="/elastic-search-in-a-box-with-docker/">Search In A Box With Docker, Elastic Search, Spring Boot, and Selenium</a></li> <li><a href="/selenium-visual-testing/">Visual Testing With Selenium WebDriver</a></li> </ol> <div id=disqus_thread></div> <script>
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'alexecollins'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> <div class=col-md-3 id=sidebar> <center> <h2>Alex Collins</h2> <p> <a href="/"><img src="/images/alex-collins-circle.png"/></a> </p> </center> <p> Java technical lead and solutions architect in London for the UK IT industry for over ten years. <a href="/about-me">more...</a> </p> <h4>Docker Maven Plugin</h4> <p>Version 2.11.7 released, <a href="https://github.com/alexec/docker-maven-plugin/blob/master/CHANGELOG.md">more...</a></p> <pre style="font-size:50%">&lt;dependency&gt;
  &lt;groupId&gt;com.alexecollins.docker&lt;/groupId&gt;
  &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.11.7&lt;/version&gt;
&lt;/dependency&gt;</pre> <h4>Recent</h4> <ul> <li><a href="/developing-with-docker-debug-container/">Developing With Docker - The Debug Container</a> <span>Dec 9</span></li> <li><a href="/developing-with-docker-proxy-container/">Developing With Docker - Using A Proxy Container To Make Development Easier</a> <span>Nov 28</span></li> <li><a href="/practical-domain-specific-language-tutorial/">Practical Java Domain Specific Language Tutorial</a> <span>Sep 19</span></li> <li><a href="/sonarqube-and-java-8/">Sonarqube And Java 8</a> <span>Sep 17</span></li> <li><a href="/spring-boot-performance/">Spring Boot Performance</a> <span>Sep 5</span></li> </ul> <h4>Tags</h4> <a href="/tags/ci/">ci</a> (3)</a>&nbsp;&nbsp; <a href="/tags/concurrency/">concurrency</a> (4)</a>&nbsp;&nbsp; <a href="/tags/docker/">docker</a> (12)</a>&nbsp;&nbsp; <a href="/tags/gist/">gist</a> (13)</a>&nbsp;&nbsp; <a href="/tags/groovy/">groovy</a> (4)</a>&nbsp;&nbsp; <a href="/tags/java/">java</a> (48)</a>&nbsp;&nbsp; <a href="/tags/jmeter/">jmeter</a> (3)</a>&nbsp;&nbsp; <a href="/tags/junit/">junit</a> (7)</a>&nbsp;&nbsp; <a href="/tags/links/">links</a> (14)</a>&nbsp;&nbsp; <a href="/tags/maven/">maven</a> (18)</a>&nbsp;&nbsp; <a href="/tags/oped/">oped</a> (8)</a>&nbsp;&nbsp; <a href="/tags/performance/">performance</a> (6)</a>&nbsp;&nbsp; <a href="/tags/plaf/">plaf</a> (14)</a>&nbsp;&nbsp; <a href="/tags/ruby/">ruby</a> (3)</a>&nbsp;&nbsp; <a href="/tags/selenium/">selenium</a> (9)</a>&nbsp;&nbsp; <a href="/tags/software/">software</a> (10)</a>&nbsp;&nbsp; <a href="/tags/spring/">spring</a> (7)</a>&nbsp;&nbsp; <a href="/tags/swing/">swing</a> (15)</a>&nbsp;&nbsp; <a href="/tags/testing/">testing</a> (23)</a>&nbsp;&nbsp; <a href="/tags/tips/">tips</a> (4)</a>&nbsp;&nbsp; <a href="/tags/tomcat/">tomcat</a> (3)</a>&nbsp;&nbsp; <a href="/tags/unix/">unix</a> (6)</a>&nbsp;&nbsp; <a href="/tags/web/">web</a> (4)</a>&nbsp;&nbsp; </hr/> <p> <a class="btn btn-primary btn-xs" href="/sitemap">Sitemap</a> <a class="btn btn-primary btn-xs" href="/feed.xml">RSS</a> <a class="btn btn-primary btn-xs" href="//uk.linkedin.com/in/alexecollins">LinkedIn</a> </p> </div> </div> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-25388993-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script> </body> </html>