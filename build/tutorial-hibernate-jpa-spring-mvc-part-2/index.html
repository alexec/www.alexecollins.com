<!doctype html> <html> <head> <meta charset=utf-8 /> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <meta name=viewport content="width=device-width, initial-scale=1.0"> <meta name=google-site-verification content=459WLyNfyiKwT7T3IzdCjzIpNP-IVQSOb4tR8b2vQhI /> <title>Alex Collins - Tutorial: Hibernate, JPA & Spring MVC - Part 2</title> <link href="/css/bootstrap.min.css" media=screen rel=stylesheet /> <style type="text/css">
.highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight {
  color: #faf6e4;
  background-color: #122b3b;
}
.highlight .gl {
  color: #dee5e7;
  background-color: #4e5d62;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #6c8b9f;
  font-style: italic;
}
.highlight .cp {
  color: #b2fd6d;
  font-weight: bold;
  font-style: italic;
}
.highlight .err {
  color: #fefeec;
  background-color: #cc0000;
}
.highlight .gr {
  color: #fefeec;
  background-color: #cc0000;
}
.highlight .k, .highlight .kd, .highlight .kv {
  color: #f6dd62;
  font-weight: bold;
}
.highlight .o, .highlight .ow {
  color: #4df4ff;
}
.highlight .p, .highlight .pi {
  color: #4df4ff;
}
.highlight .gd {
  color: #cc0000;
}
.highlight .gi {
  color: #b2fd6d;
}
.highlight .ge {
  font-style: italic;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gt {
  color: #dee5e7;
  background-color: #4e5d62;
}
.highlight .kc {
  color: #f696db;
  font-weight: bold;
}
.highlight .kn {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kp {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kr {
  color: #ffb000;
  font-weight: bold;
}
.highlight .gh {
  color: #ffb000;
  font-weight: bold;
}
.highlight .gu {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kt {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .no {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nc {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nd {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nn {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .bp {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .ne {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nl {
  color: #ffb000;
  font-weight: bold;
}
.highlight .nt {
  color: #ffb000;
  font-weight: bold;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #f696db;
  font-weight: bold;
}
.highlight .ld {
  color: #f696db;
  font-weight: bold;
}
.highlight .ss {
  color: #f696db;
  font-weight: bold;
}
.highlight .s, .highlight .sb, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .sr, .highlight .s1 {
  color: #fff0a6;
  font-weight: bold;
}
.highlight .se {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .sc {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .si {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .nb {
  font-weight: bold;
}
.highlight .ni {
  color: #999999;
  font-weight: bold;
}
.highlight .w {
  color: #BBBBBB;
}
.highlight .nf {
  color: #a8e1fe;
}
.highlight .py {
  color: #a8e1fe;
}
.highlight .na {
  color: #a8e1fe;
}
.highlight .nv, .highlight .vc, .highlight .vg, .highlight .vi {
  color: #a8e1fe;
  font-weight: bold;
}	.article img {
		border: 1px solid #bbb;
		display: block;
		margin-left: auto;
		margin-right: auto;
		padding: 10px;
	}
	@media print {
		#disqus_thread, #sidebar {
    			display:none;
  		}
	}
</style> <link href="https://plus.google.com/101694420547181110548" rel=publisher /> </head> <body class="tutorial-hibernate-jpa-spring-mvc-part-2 tutorial-hibernate-jpa-spring-mvc-part-2_index"> <div class=container> <div class=row> <div class="col-md-9 article"> <h1>Tutorial: Hibernate, JPA & Spring MVC - Part 2</h1> <table class=table> <tr> <td> <center> <a href="//selenium-webdriver-in-practice.github.io"><img src="/images/liang_cover100.jpg" class=thumbnail /></a> </center> </td> <td> <p class=well><b>Big news!</b> I've been working hard getting <b>Selenium WebDriver in Practice</b> ready and it is now available to buy on the <a href="//selenium-webdriver-in-practice.github.io">Manning Early Access Program</a>. It provides practical and useful techniques you can use with WebDriver, to get the very best out of it in your projects.</p> </td> </tr> </table> <h2>Overview</h2> <p>This tutorial will show you how to take a basic Hibernate/JPA app, convert it into a Spring MVC web project to be able to view the database in a web browser, and finally use Spring's @Transactional annotation to reduce boiler plate code.</p> <p>This tutorial assumes you're familiar with Java and Maven, and that you've completed the <a href="/tutorial-hibernate-jpa-part-1">first part of this tutorial</a>. You'll also need to have downloaded and installed Tomcat.</p> <p>You may wish to check out the code freshly from <a href="https://github.com/alexec/tutorial-hibernate-jpa/tree/part-1">Github</a>.</p> <h2>Container Managed Data-Source</h2> <p>There a number of key files that we'll need to amend or create to convert the code from part 1 into a web project. The first thing we'll need to do (assuming you've got Tomcat installed and have set CATALINA_HOME in your computer's environment) is to move the JDBC configuration to Tomcat's so that the data-source's are managed by Tomcat, rather than programatically, and can be accessed using JNDI.</p> <p>To do this, add the following lines inside the GlobalNamingResources element of $CATALINA_HOME/conf/server.xml:</p> <pre class="highlight xml">	<span class="nt">&lt;Resource</span> <span class="na">auth=</span><span class="s">"Container"</span> 
	    <span class="na">driverClassName=</span><span class="s">"org.apache.derby.jdbc.EmbeddedDriver"</span> 
	    <span class="na">maxActive=</span><span class="s">"8"</span> <span class="na">maxIdle=</span><span class="s">"4"</span> 
	    <span class="na">name=</span><span class="s">"jdbc/tutorialDS"</span> <span class="na">type=</span><span class="s">"javax.sql.DataSource"</span> 
	    <span class="na">url=</span><span class="s">"jdbc:derby:tutorialDB;create=true"</span> 
	    <span class="na">username=</span><span class="s">""</span> <span class="na">password=</span><span class="s">""</span> <span class="nt">/&gt;</span>
</pre> <p>A jar containing org.apache.derby.jdbc.EmbeddedDriver needs to be available to Tomcat. An quick way to get the jar is from your Maven local repository, e.g. ~/.m2/repository/org/apache/derby/derby/10.4.1.3/derby-10.4.1.3.jar. Copy that file into $CATALINA_HOME/lib and restart Tomcat to make sure there was no errors.</p> <p>These changes will create a data source that deployed applications can access. In Tomcat 7 you can view the managed resources at <a href="//localhost:8080/manager/text/resources">http://localhost:8080/manager/text/resources</a>; you should see something like:</p> <pre class="highlight plaintext">OK - Listed global resources of all types
jdbc/tutorialDS:org.apache.tomcat.dbcp.dbcp.BasicDataSource
UserDatabase:org.apache.catalina.users.MemoryUserDatabase
</pre> <h2>Converting Into a Web Project</h2> <p>Using the some project from part 1 we need to make the following changes:</p> <p>We need to change the project to produce a web archive, so in the pom.xml add the following:</p> <pre class="highlight xml"><span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
</pre> <p>You'll want to add (as a convenience) a line inside the build section that creates a .war without the project version:</p> <pre class="highlight xml"><span class="nt">&lt;finalName&gt;</span>${project.artifactId}<span class="nt">&lt;/finalName&gt;</span>
</pre> <p>We also need the servlet API libraries:</p> <pre class="highlight xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>servlet-api<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>2.5<span class="nt">&lt;/version&gt;</span>
	<span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre> <p>Note: the scope for this is "provided", as Tomcat already has a built in servlet library.</p> <p>So that the data-source is available to the app, create src/main/webapp/META-INF/context.xml with the following lines:</p> <pre class="highlight xml"><span class="nt">&lt;Context&gt;</span>
	<span class="nt">&lt;ResourceLink</span> <span class="na">global=</span><span class="s">"jdbc/tutorialDS"</span> <span class="na">name=</span><span class="s">"jdbc/tutorialDS"</span> <span class="na">type=</span><span class="s">"javax.sql.DataSource"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Context&gt;</span>

<span class="nt">&lt;p&gt;</span>This makes the data-source managed by Tomcat available to our app. We also need a stub for src/main/webapp/WEB-INF/web.xml:<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;web-app</span>
	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>
	<span class="na">version=</span><span class="s">"2.5"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</pre> <p>Compile and deploy the app to Tomcat. You won't be able to see anything at this point, as there are no servlets or pages.</p> <p>It's possible to get Maven to build and deploy to Maven for you, or you can run Tomcat within most IDEs. There's plenty of articles on this elsewhere, so I won't cover it here.</p> <h2>Adding Spring MVC</h2> <p>We're going to use Spring MVC for this, so we need some additional changes to support that:</p> <p>Add the following dependency to your pom.xml:</p> <pre class="highlight xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>3.0.6.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre> <p>We want to tell Tomcat to use Spring to dispatch requests, so we need to add the following lines to our web.xml:</p> <pre class="highlight xml"><span class="nt">&lt;context-param&gt;</span>
	<span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
	<span class="nt">&lt;param-value&gt;</span>/WEB-INF/mvc-dispatcher-servlet.xml<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span>
	
<span class="nt">&lt;listener&gt;</span>
	<span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="nt">&lt;/listener&gt;</span>
	
<span class="nt">&lt;servlet&gt;</span>
	<span class="nt">&lt;servlet-name&gt;</span>mvc-dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
	<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
	<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
	
<span class="nt">&lt;servlet-mapping&gt;</span>
	<span class="nt">&lt;servlet-name&gt;</span>mvc-dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
	<span class="nt">&lt;url-pattern&gt;</span>*.html<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>
</pre> <p>This will forward all requests for pages ending in ".html" to Spring and Spring will choose the appropriate controller to service each request. We also need to create an application context for Spring servlets, and this must live in src/main/webapp/WEB-INF/mvc-dispatcher-servlet.xml:</p> <pre class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>	
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
   	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
   	<span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
  	<span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd"</span><span class="nt">&gt;</span>
   	
   	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"tutorial"</span><span class="nt">/&gt;</span>
   	<span class="nt">&lt;context:annotation-config/&gt;</span>
   	
   	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span><span class="nt">&gt;</span>
	   	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"prefix"</span><span class="nt">&gt;&lt;value&gt;</span>/WEB-INF/pages/<span class="nt">&lt;/value&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"suffix"</span><span class="nt">&gt;&lt;value&gt;</span>.jsp<span class="nt">&lt;/value&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre> <p>This XML does two things:</p> <ol> <li>It tells Spring to scan classes in the package "tutorial" and beneath for classes annotated as beans.</li> <li>How to convert the name of a view into it's resource. Essentially it says "take the name, prefix it with '/WEB-INF/pages' then suffix the result with '.jsp'".</li> </ol> <p>You might want to redeploy this to smoke test it.</p> <p>To test this we'll need to display a page. The first page will be to display a list of all the users. We'll need two files; the first is the controller that services requests:</p> <pre class="highlight java"><span class="kn">package</span> <span class="n">tutorial</span><span class="o">;</span>
	
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
	
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsersController</span> <span class="o">{</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="n">users</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"users"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre> <p>The second item is the page to display. This is based on the string returned by UsersController.users(), and using the rules for the resource resolver, we know this file must be WEB-INF/pages/users.jsp. Create stub of the page, something like:</p> <pre class="highlight html"><span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;h1&gt;</span>Users<span class="nt">&lt;/h1&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre> <p>Finally, you can test this by redeploying to Tomcat and using a browser to view <a href="//localhost:8080/tutorial-hibernate-jpa/users.html">http://localhost:8080/tutorial-hibernate-jpa/users.html</a>.</p> <h2>Adding Spring ORM</h2> <p>Spring contains support for injecting entity managers into beans, and this requires only a few lines of code to be added to your pom.xml and mvc-dispatcher-context.xml:</p> <pre class="highlight xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-orm<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>3.0.6.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre> <pre class="highlight xml"><span class="nt">&lt;jee:jndi-lookup</span> <span class="na">id=</span><span class="s">"tutorialDS"</span> <span class="na">jndi-name=</span><span class="s">"java:/comp/env/jdbc/tutorialDS"</span> <span class="na">expected-type=</span><span class="s">"javax.sql.DataSource"</span><span class="nt">/&gt;</span>
	
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"entityManagerFactory"</span> <span class="na">class=</span><span class="s">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"tutorialDS"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre> <p>The "jndi-lookup" element creates a bean from a JNDI resource, and this is used by the entity manager factory to create entity managers. Other JNDI objects can also be looked up in this fashion.</p> <p>Note: you'll need to add the XML namespace and XSD to the root element: xmlns:jee="http://www.springframework.org/schema/jee."</p> <p>Finally, we can add code to get the entity manager injected into our controller and get users from the database.</p> <pre class="highlight java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsersController</span> <span class="o">{</span>
	
	<span class="nd">@PersistenceContext</span>
	<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="n">users</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
	
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"users"</span><span class="o">,</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select u from User u"</span><span class="o">).</span><span class="na">getResultList</span><span class="o">());</span>
	
	        <span class="k">return</span> <span class="s">"users"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre> <p>This code uses the entity manager to get all the users and binds it to an attribute called "users" that will be visible to our JSPs.</p> <p>We will want to show the users on the page. For this, I'll use JSTL; you can use another technology if you prefer, but I'll quickly give you the bits you'd need if not. Again, there's plenty of good tutorials on JSTL out there if you're not familiar. Firstly, add another dependency to you pom.xml:</p> <pre class="highlight xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre> <p>And update users.html displays the users:</p> <pre class="highlight xml"><span class="err">&lt;</span>%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
<span class="nt">&lt;html&gt;</span>
body&gt;
	<span class="nt">&lt;h1&gt;</span>Users<span class="nt">&lt;/h1&gt;</span>
	<span class="nt">&lt;table&gt;</span>
	    <span class="nt">&lt;thead&gt;&lt;tr&gt;&lt;td&gt;</span>ID<span class="nt">&lt;/td&gt;&lt;td&gt;</span>Name<span class="nt">&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;</span>
	    <span class="nt">&lt;tbody&gt;</span>
	        <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"user"</span> <span class="na">items=</span><span class="s">"${users}"</span><span class="nt">&gt;</span>
	        <span class="nt">&lt;tr&gt;&lt;td&gt;</span>${user.id}<span class="nt">&lt;/td&gt;&lt;td&gt;</span>${user.name}<span class="nt">&lt;/td&gt;&lt;/tr&gt;</span>
	        <span class="nt">&lt;/c:forEach&gt;</span>
	    <span class="nt">&lt;/tbody&gt;</span>
	<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre> <p>Finally, you can smoke test this in your browser.</p> <h2>@Transactional</h2> <p>The final piece of the puzzle is creating a user. To do this, we'll need a basic form, for example I've made pages/create-user.jsp:</p> <pre class="highlight html"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
	<span class="nt">&lt;h1&gt;</span>Create User<span class="nt">&lt;/h1&gt;</span>
	<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
	Name: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre> <p>We need a controller to access this, so add this to UsersController:</p> <pre class="highlight java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/create-user"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createUser</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="s">"create-user"</span><span class="o">;</span>
<span class="o">}</span>
</pre> <p>Note: that this method only accepts GET requests. When we POST the form, we'll need another method. You can smoke test this by redeploying to Tomcat and browsing to <a href="//localhost:8080/tutorial-hibernate-jpa/create-user.html">http://localhost:8080/tutorial-hibernate-jpa/create-user.html</a>. You'll note that submitting the page results in a HTTP 405 error. We can service POST requests with the following (overloaded) method:</p> <pre class="highlight java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/create-user"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createUser</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
	        
	<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
	<span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
	        
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
	        
	<span class="k">return</span> <span class="s">"redirect:/users.html"</span><span class="o">;</span>
<span class="o">}</span>
</pre> <p>We've used the @Transactional annotation here. When we do this, Spring will create a proxy object for our bean and manage the transaction for us, beginning, committing and rolling back when errors occur. This is much less code (one line vs about a dozen) and safer (less chance for a typographical error) than opening and closing the transaction ourself. You can see an example of the code for the verbose version in <a href="/tutorial-hibernate-jpa-part-1">this post</a>. We need to tell Spring to support this by adding the following lines to our Spring context: telling it to use annotation based transactions, and what bean should manage the transactions:</p> <pre class="highlight xml"><span class="nt">&lt;tx:annotation-driven/&gt;</span>
	
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"transactionManager"</span> <span class="na">class=</span><span class="s">"org.springframework.orm.jpa.JpaTransactionManager"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"entityManagerFactory"</span> <span class="na">ref=</span><span class="s">"entityManagerFactory"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre> <p>Note: you'll need to add the correct schema the the document too:</p> <pre class="highlight plaintext">xmlns:tx="http://www.springframework.org/schema/tx"
...
http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd ~~~
</pre> <p>You can test this by going to the page and submitting a new user. You'll be redirected to the users page afterwards where you should be able to see your new user.</p> <h2>Conclusion</h2> <p>In this example, there are more lines of XML than Java, but most of the XML is one-off set-up, and you'll find that as your app gets larger, the ratio drops. You can use Spring to support JPA entities, making a migration to/from JEE easier.</p> <p>I've only covered the "C" and "R" parts of CRUD here, you should have enough information here to be able to try the rest yourself.</p> <p>The code for this is on <a href="https://github.com/alexec/tutorial-hibernate-jpa/tree/part-2">Github</a>.</p> <div id=disqus_thread></div> <script>
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'alexecollins'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> <div class=col-md-3 id=sidebar> <center> <h2>Alex Collins</h2> <p> <a href="/"><img src="/images/alex-collins-circle.png"/></a> </p> </center> <p> Java technical lead and solutions architect in London for the UK IT industry for over ten years. <a href="/about-me">more...</a> </p> <h4>Docker Maven Plugin</h4> <p>Version 2.11.4 released, <a href="https://github.com/alexec/docker-maven-plugin/blob/master/CHANGELOG.md">more...</a></p> <pre style="font-size:50%">&lt;dependency&gt;
  &lt;groupId&gt;com.alexecollins.docker&lt;/groupId&gt;
  &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.11.4&lt;/version&gt;
&lt;/dependency&gt;</pre> <h4>Related</h4> <ol> <li><a href="/tutorial-hibernate-jpa-part-1/">Tutorial: Hibernate, JPA - Part 1</a></li> <li><a href="/spring-boot-performance/">Spring Boot Performance</a></li> <li><a href="/tutorial-integration-testing-selenium-part-2/">Tutorial: Integration Testing with Selenium - Part 2</a></li> <li><a href="/tutorial-integration-testing-selenium-part-1/">Tutorial: Integration Testing with Selenium - Part 1</a></li> <li><a href="/spring-mvc-and-mongodb-auditing-actions/">Spring MVC and MongoDB - Auditing Actions</a></li> </ol> <h4>Recent</h4> <ul> <li><a href="/developing-with-docker-proxy-container/">Developing With Docker - Using A Proxy Container To Make Development Easier</a> <span>Nov 28</span></li> <li><a href="/practical-domain-specific-language-tutorial/">Practical Java Domain Specific Language Tutorial</a> <span>Sep 19</span></li> <li><a href="/sonarqube-and-java-8/">Sonarqube And Java 8</a> <span>Sep 17</span></li> <li><a href="/spring-boot-performance/">Spring Boot Performance</a> <span>Sep 5</span></li> <li><a href="/testing-anti-patterns/">Testing Anti-Patterns</a> <span>Jun 23</span></li> </ul> <h4>Tags</h4> <a href="/tags/ci/">ci</a> (3)</a>&nbsp;&nbsp; <a href="/tags/concurrency/">concurrency</a> (4)</a>&nbsp;&nbsp; <a href="/tags/docker/">docker</a> (11)</a>&nbsp;&nbsp; <a href="/tags/gist/">gist</a> (13)</a>&nbsp;&nbsp; <a href="/tags/groovy/">groovy</a> (4)</a>&nbsp;&nbsp; <a href="/tags/java/">java</a> (48)</a>&nbsp;&nbsp; <a href="/tags/jmeter/">jmeter</a> (3)</a>&nbsp;&nbsp; <a href="/tags/junit/">junit</a> (7)</a>&nbsp;&nbsp; <a href="/tags/links/">links</a> (14)</a>&nbsp;&nbsp; <a href="/tags/maven/">maven</a> (18)</a>&nbsp;&nbsp; <a href="/tags/oped/">oped</a> (8)</a>&nbsp;&nbsp; <a href="/tags/performance/">performance</a> (6)</a>&nbsp;&nbsp; <a href="/tags/plaf/">plaf</a> (14)</a>&nbsp;&nbsp; <a href="/tags/ruby/">ruby</a> (3)</a>&nbsp;&nbsp; <a href="/tags/selenium/">selenium</a> (9)</a>&nbsp;&nbsp; <a href="/tags/software/">software</a> (10)</a>&nbsp;&nbsp; <a href="/tags/spring/">spring</a> (7)</a>&nbsp;&nbsp; <a href="/tags/swing/">swing</a> (15)</a>&nbsp;&nbsp; <a href="/tags/testing/">testing</a> (23)</a>&nbsp;&nbsp; <a href="/tags/tips/">tips</a> (4)</a>&nbsp;&nbsp; <a href="/tags/tomcat/">tomcat</a> (3)</a>&nbsp;&nbsp; <a href="/tags/unix/">unix</a> (6)</a>&nbsp;&nbsp; <a href="/tags/web/">web</a> (4)</a>&nbsp;&nbsp; </hr/> <p> <a class="btn btn-primary btn-xs" href="/sitemap">Sitemap</a> <a class="btn btn-primary btn-xs" href="/feed.xml">RSS</a> <a class="btn btn-primary btn-xs" href="//uk.linkedin.com/in/alexecollins">LinkedIn</a> </p> </div> </div> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-25388993-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script> </body> </html>